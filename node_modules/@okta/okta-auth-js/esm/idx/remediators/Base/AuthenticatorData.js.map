{"version":3,"sources":["../../../../../lib/idx/remediators/Base/AuthenticatorData.ts"],"names":["Remediator","AuthenticatorData","constructor","remediation","values","authenticators","authenticatorType","getRelatesToType","authenticator","find","type","map","mapAuthenticatorFromValues","getNextStep","common","options","getMethodTypes","getAuthenticatorFromValues","methodType","getAuthenticatorFromRemediation","value","name","form"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,SAASA,UAAT,QAA8C,cAA9C;AAQA;AACA,OAAO,MAAMC,iBAAN,SAAgCD,UAAhC,CAA2C;AAQhDE,EAAAA,WAAW,CAACC,WAAD,EAAoE;AAAA,QAAtCC,MAAsC,uEAAJ,EAAI;AAC7E,UAAMD,WAAN,EAAmBC,MAAnB,EAD6E,CAG7E;;AAH6E,iCANzE;AACJ,uBAAiB;AADb,KAMyE;;AAI7E,QAAM;AAAEC,MAAAA;AAAF,QAAqB,KAAKD,MAAhC;AACA,QAAME,iBAAiB,GAAG,KAAKC,gBAAL,EAA1B;AACA,QAAMC,aAAa,GAAIH,cAAJ,aAAIA,cAAJ,uBAAIA,cAAD,CAChBI,IADgB,CACXD,aAAa,IAAIA,aAAa,CAACE,IAAd,KAAuBJ,iBAD7B,CAAtB;;AAEA,QAAIE,aAAJ,EAAmB;AACjB;AACA,WAAKJ,MAAL,CAAYC,cAAZ,GAA6BA,cAAc,CAACM,GAAf,CAAmBH,aAAa,IAAI;AAC/D,YAAIF,iBAAiB,KAAKE,aAAa,CAACE,IAAxC,EAA8C;AAC5C,iBAAO,KAAKE,0BAAL,CAAgCJ,aAAhC,CAAP;AACD;;AACD,eAAOA,aAAP;AACD,OAL4B,CAA7B;AAMD,KARD,MAQO;AACL;AACA,WAAKJ,MAAL,CAAYC,cAAZ,GAA6B,CAC3B,GAAGA,cADwB,EAE3B,KAAKO,0BAAL,EAF2B,CAA7B;AAID;AACF;;AAEDC,EAAAA,WAAW,GAAG;AACZ,QAAMC,MAAM,GAAG,MAAMD,WAAN,EAAf;AACA,QAAME,OAAO,GAAG,KAAKC,cAAL,EAAhB;AACA,2CACKF,MADL,GAEMC,OAAO,IAAI;AAAEA,MAAAA;AAAF,KAFjB;AAID,GAxC+C,CA0ChD;;;AACUE,EAAAA,0BAA0B,GAAkB;AACpD,QAAI,CAAC,KAAKb,MAAL,CAAYC,cAAjB,EAAiC;AAC/B,aAAO,IAAP;AACD;;AAED,QAAMC,iBAAiB,GAAG,KAAKC,gBAAL,EAA1B;AACA,QAAMC,aAAa,GAAI,KAAKJ,MAAL,CAAYC,cAAb,CACnBI,IADmB,CACdD,aAAa,IAAIA,aAAa,CAACE,IAAd,KAAuBJ,iBAD1B,CAAtB;AAEA,WAAOE,aAAP;AACD;;AAESI,EAAAA,0BAA0B,CAACJ,aAAD,EAA+C;AACjF;AACA,QAAME,IAAI,GAAG,KAAKH,gBAAL,EAAb;AACA,QAAM;AAAEW,MAAAA;AAAF,QAAiB,KAAKd,MAA5B;AACA;AACEM,MAAAA;AADF,OAEMF,aAAa,IAAIA,aAFvB,GAGMU,UAAU,IAAI;AAAEA,MAAAA;AAAF,KAHpB;AAKD;;AAESC,EAAAA,+BAA+B,GAAwB;AAC/D,QAAMX,aAAa,GAAG,KAAKL,WAAL,CAAiBiB,KAAjB,CACnBX,IADmB,CACd;AAAA,UAAC;AAAEY,QAAAA;AAAF,OAAD;AAAA,aAAcA,IAAI,KAAK,eAAvB;AAAA,KADc,CAAtB;AAEA,WAAOb,aAAP;AACD;;AAEOQ,EAAAA,cAAc,GAAgB;AAAA;;AACpC,QAAMR,aAAkC,GAAG,KAAKW,+BAAL,EAA3C;AACA,oCAAOX,aAAa,CAACc,IAAd,CAAmBF,KAAnB,CAAyBX,IAAzB,CAA8B;AAAA,UAAC;AAAEY,QAAAA;AAAF,OAAD;AAAA,aAAcA,IAAI,KAAK,YAAvB;AAAA,KAA9B,CAAP,0DAAO,sBAAoEN,OAA3E;AACD;;AA1E+C","sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\nimport { Remediator, RemediationValues } from './Remediator';\nimport { Authenticator } from '../../types';\nimport { IdxRemediationValue, IdxOption, IdxRemediation } from '../../types/idx-js';\n\nexport type AuthenticatorDataValues = RemediationValues & {\n  methodType?: string;\n};\n\n// Base class - DO NOT expose static remediationName\nexport class AuthenticatorData extends Remediator {\n\n  map = {\n    'authenticator': []\n  };\n\n  values: AuthenticatorDataValues;\n\n  constructor(remediation: IdxRemediation, values: AuthenticatorDataValues = {}) {\n    super(remediation, values);\n\n    // Unify authenticator input type\n    const { authenticators } = this.values;\n    const authenticatorType = this.getRelatesToType();\n    const authenticator = (authenticators as Authenticator[])\n        ?.find(authenticator => authenticator.type === authenticatorType);\n    if (authenticator) {\n      // map\n      this.values.authenticators = authenticators.map(authenticator => {\n        if (authenticatorType === authenticator.type) {\n          return this.mapAuthenticatorFromValues(authenticator);\n        }\n        return authenticator;\n      });\n    } else {\n      // add\n      this.values.authenticators = [\n        ...authenticators, \n        this.mapAuthenticatorFromValues()\n      ] as Authenticator[];\n    }\n  }\n\n  getNextStep() {\n    const common = super.getNextStep();\n    const options = this.getMethodTypes();\n    return { \n      ...common, \n      ...(options && { options }) \n    };\n  }\n\n  // Grab authenticator from authenticators list\n  protected getAuthenticatorFromValues(): Authenticator {\n    if (!this.values.authenticators) {\n      return null;\n    }\n\n    const authenticatorType = this.getRelatesToType();\n    const authenticator = (this.values.authenticators as Authenticator[])\n      .find(authenticator => authenticator.type === authenticatorType);\n    return authenticator;\n  }\n\n  protected mapAuthenticatorFromValues(authenticator?: Authenticator): Authenticator {\n    // add methodType to authenticator if it exists in values\n    const type = this.getRelatesToType();\n    const { methodType } = this.values;\n    return { \n      type, \n      ...(authenticator && authenticator),\n      ...(methodType && { methodType }) \n    };\n  }\n\n  protected getAuthenticatorFromRemediation(): IdxRemediationValue {\n    const authenticator = this.remediation.value\n      .find(({ name }) => name === 'authenticator');\n    return authenticator;\n  }\n\n  private getMethodTypes(): IdxOption[] {\n    const authenticator: IdxRemediationValue = this.getAuthenticatorFromRemediation();\n    return authenticator.form.value.find(({ name }) => name === 'methodType')?.options;\n  }\n}\n"],"file":"AuthenticatorData.js"}