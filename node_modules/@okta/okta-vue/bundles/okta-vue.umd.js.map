{"version":3,"file":"okta-vue.umd.js","sources":["../../src/okta-vue.ts","../../src/components/LoginCallback.vue"],"sourcesContent":["/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { App } from 'vue'\nimport { Router, RouteLocationNormalized } from 'vue-router'\nimport { AuthSdkError, OktaAuth, AuthState, toRelativeUrl } from '@okta/okta-auth-js'\nimport { OktaVueOptions, OnAuthRequiredFunction } from './types'\n\n// constants are defined in webpack.config.js\ndeclare const PACKAGE: {\n  name: string;\n  version: string;\n}\n\nlet _oktaAuth: OktaAuth\nlet _onAuthRequired: OnAuthRequiredFunction\nlet _router: Router\nlet originalUriTracker: string\n\nconst guardSecureRoute = async (authState: AuthState) => {\n  if (!authState.isAuthenticated) {\n    _oktaAuth.setOriginalUri(originalUriTracker)\n    if (_onAuthRequired) {\n      await _onAuthRequired(_oktaAuth)\n    } else {\n      await _oktaAuth.signInWithRedirect()\n    }\n  }\n}\n\nexport const navigationGuard = async (to: RouteLocationNormalized) => {\n  // clear any subscribed guardSecureRoute\n  _oktaAuth.authStateManager.unsubscribe(guardSecureRoute)\n\n  if (to.matched.some(record => record.meta.requiresAuth)) {\n    // track the originalUri for guardSecureRoute\n    originalUriTracker = to.fullPath\n\n    // subscribe to authState change to protect secure routes when authState change\n    // all secure routes should subscribe before enter the route\n    _oktaAuth.authStateManager.subscribe(guardSecureRoute)\n\n    // guard the secure route based on the authState when enter\n    const isAuthenticated = await _oktaAuth.isAuthenticated()\n    if (!isAuthenticated) {\n      const authState = _oktaAuth.authStateManager.getAuthState()\n      await guardSecureRoute(authState)\n      return false\n    }\n\n    return true\n  }\n    \n  return true\n}\n\n\nfunction install (app: App, {\n  oktaAuth,\n  onAuthRequired,\n  onAuthResume\n} = {} as OktaVueOptions) {\n  if (!oktaAuth) {\n    throw new AuthSdkError('No oktaAuth instance passed to OktaVue.')\n  }\n\n  const oktaAuthMajorVersion = oktaAuth.userAgent?.split('/')[1]?.split('.')[0];\n  if (oktaAuthMajorVersion && oktaAuthMajorVersion !== process.env.AUTH_JS_MAJOR_VERSION) {\n    throw new AuthSdkError(`\n      Passed in oktaAuth is not compatible with the SDK,\n      okta-auth-js version ${process.env.AUTH_JS_MAJOR_VERSION}.x is the current supported version.\n    `);\n  }\n\n  _oktaAuth = oktaAuth\n  _onAuthRequired = onAuthRequired\n\n  // customize user agent\n  oktaAuth.userAgent = `${PACKAGE.name}/${PACKAGE.version} ${oktaAuth.userAgent}`\n\n  // add default restoreOriginalUri callback\n  if (!oktaAuth.options.restoreOriginalUri) {\n    oktaAuth.options.restoreOriginalUri = async (oktaAuth: OktaAuth, originalUri: string) => {\n      // If a router is available, provide a default implementation\n      if (_router && originalUri) {\n        const path = toRelativeUrl(originalUri, window.location.origin)\n        _router.replace({ path })\n      }\n    }\n  }\n\n  app.mixin({\n    data () {\n      return {\n        authState: oktaAuth.authStateManager.getAuthState()\n      }\n    },\n    beforeCreate () {\n      // assign router for the default restoreOriginalUri callback\n      _router = this.$router\n    },\n    created () {\n      // subscribe to the latest authState\n      oktaAuth.authStateManager.subscribe(this.$_oktaVue_handleAuthStateUpdate)\n      if (!oktaAuth.token.isLoginRedirect()) {\n        // Calculates initial auth state and fires change event for listeners\n        // Also starts the token auto-renew service\n        oktaAuth.start();\n      }\n    },\n    beforeUnmount () {\n      oktaAuth.authStateManager.unsubscribe(this.$_oktaVue_handleAuthStateUpdate)\n      oktaAuth.stop()\n    },\n    // private property naming convention follows\n    // https://vuejs.org/v2/style-guide/#Private-property-names-essential\n    methods: {\n      // eslint-disable-next-line @typescript-eslint/camelcase\n      async $_oktaVue_handleAuthStateUpdate (authState: AuthState) {\n        this.authState = Object.assign(this.authState || {}, authState)\n      }\n    }\n  })\n\n  // add additional options to oktaAuth options\n  Object.assign(oktaAuth.options, {\n    onAuthRequired,\n    onAuthResume\n  })\n\n  // add oktaAuth instance to Vue\n  app.config.globalProperties.$auth = oktaAuth\n}\n\nexport default { install }\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'LoginCallback',\n  data() {\n    return {\n      error: null\n    };\n  },\n  async beforeMount () {\n    try {\n      await this.$auth.handleLoginRedirect()\n    } catch (e) {\n      if (this.$auth.isInteractionRequiredError(e)) {\n        const { onAuthResume, onAuthRequired } = this.$auth.options;\n        const callbackFn = onAuthResume || onAuthRequired;\n        if (callbackFn) {\n          callbackFn(this.$auth);\n          return;\n        }\n      }\n      this.error = e.toString();\n    }\n  },\n  render() {\n    return this.error\n  }\n})\n</script>\n"],"names":["_oktaAuth","_onAuthRequired","_router","originalUriTracker","guardSecureRoute","authState","isAuthenticated","setOriginalUri","_a","signInWithRedirect","install","app","_d","oktaAuth","onAuthRequired","onAuthResume","AuthSdkError","oktaAuthMajorVersion","userAgent","split","options","restoreOriginalUri","originalUri","path","toRelativeUrl","window","location","origin","replace","mixin","data","authStateManager","getAuthState","beforeCreate","this","$router","created","subscribe","$_oktaVue_handleAuthStateUpdate","token","isLoginRedirect","start","beforeUnmount","unsubscribe","stop","methods","Object","assign","config","globalProperties","$auth","defineComponent","name","error","[object Object]","handleLoginRedirect","e","isInteractionRequiredError","callbackFn","toString","to","matched","some","record","meta","requiresAuth","fullPath"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;OAuBA,IAAIA,EACAC,EACAC,EACAC,EAEEC,EAAmB,SAAOC,sGACzBA,EAAUC,uBACbN,EAAUO,eAAeJ,GACrBF,KACIA,EAAgBD,yBAAtBQ,sBAEA,SAAMR,EAAUS,6BAAhBD,kDA6GS,CAAEE,QA7EjB,SAAkBC,EAAUH,GAA5B,eAA4BI,aAIxB,KAHFC,aACAC,mBACAC,iBAEA,IAAKF,EACH,MAAM,IAAIG,eAAa,2CAGzB,IAAMC,sBAAuBJ,EAASK,gCAAWC,MAAM,KAAK,yBAAIA,MAAM,KAAK,GAC3E,GAAIF,GAAiD,MAAzBA,EAC1B,MAAM,IAAID,eAAa,sIAMzBhB,EAAYa,EACZZ,EAAkBa,EAGlBD,EAASK,UAAe,wBAAmCL,EAASK,UAG/DL,EAASO,QAAQC,qBACpBR,EAASO,QAAQC,mBAAqB,SAAOR,EAAoBS,gFAE3DpB,GAAWoB,IACPC,EAAOC,gBAAcF,EAAaG,OAAOC,SAASC,QACxDzB,EAAQ0B,QAAQ,CAAEL,sBAKxBZ,EAAIkB,MAAM,CACRC,gBACE,MAAO,CACLzB,UAAWQ,EAASkB,iBAAiBC,iBAGzCC,wBAEE/B,EAAUgC,KAAKC,SAEjBC,mBAEEvB,EAASkB,iBAAiBM,UAAUH,KAAKI,iCACpCzB,EAAS0B,MAAMC,mBAGlB3B,EAAS4B,SAGbC,yBACE7B,EAASkB,iBAAiBY,YAAYT,KAAKI,iCAC3CzB,EAAS+B,QAIXC,QAAS,CAEDP,gCAAN,SAAuCjC,6EACrC6B,KAAK7B,UAAYyC,OAAOC,OAAOb,KAAK7B,WAAa,GAAIA,iBAM3DyC,OAAOC,OAAOlC,EAASO,QAAS,CAC9BN,iBACAC,iBAIFJ,EAAIqC,OAAOC,iBAAiBC,MAAQrC,MC5HvBsC,kBAAgB,CAC7BC,KAAM,gBACNtB,KAAI,KACK,CACLuB,MAAO,OAGXC,oBACE,UACQpB,KAAKgB,MAAMK,sBACjB,MAAOC,GACP,GAAItB,KAAKgB,MAAMO,2BAA2BD,GAAI,CAC5C,MAAMzC,aAAEA,EAAYD,eAAEA,GAAmBoB,KAAKgB,MAAM9B,QAC9CsC,EAAa3C,GAAgBD,EACnC,GAAI4C,EAEF,YADAA,EAAWxB,KAAKgB,OAIpBhB,KAAKmB,MAAQG,EAAEG,aAGnBL,SACE,OAAOpB,KAAKmB,qGDAe,SAAOO,4GAEpC5D,EAAU+B,iBAAiBY,YAAYvC,GAEnCwD,EAAGC,QAAQC,MAAK,SAAAC,GAAU,OAAAA,EAAOC,KAAKC,iBAExC9D,EAAqByD,EAAGM,SAIxBlE,EAAU+B,iBAAiBM,UAAUjC,MAGPJ,EAAUM,wCAAhBE,gBAEhBH,EAAYL,EAAU+B,iBAAiBC,kBACvC5B,EAAiBC,YACvB,OADAG,aACO,iBAMX,UAAO"}